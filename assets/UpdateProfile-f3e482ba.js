import{u as O,b as W,r as o,j as e,B as C,L as M,S as T,A as d,_ as n,s as u}from"./index-89905c0a.js";import{p as q,A as G}from"./index-1169b058.js";import{P as H}from"./PageNav-7d5021c7.js";import{s as N,F as J}from"./FormRow-f4f2ace3.js";import"./Title-3986c892.js";const i={fontSize:"20px"};function f(t){n.error(t,{style:i}),u(2500)}function U(t,s){return t?!0:(n.error(`${s} cannot be empty`,{style:i}),!1)}function Q(t,s){return t!==s?(n.error("Passwords to not match",{style:i}),!1):!0}function V(t,s){return!(!U(t,"First name cannot be empty")||!U(s,"Last name cannot be empty"))}const c=await d.currentAuthenticatedUser();function ae(){const t=O(),{attributes:s}=c,{isAuthenticated:y}=W();o.useEffect(function(){y||t("/")},[y,t]);const[w,h]=o.useState(""),[x,k]=o.useState(""),[v,F]=o.useState(""),[S,L]=o.useState(s.name),[g,E]=o.useState(s.family_name),[I,_]=o.useState(""),[R,P]=o.useState(!1);async function $(a,b,j,A,p,X,l,D,K){if(a.preventDefault(),!!Q(p,A)&&V(b,j))try{if(P(!0),await d.updateUserAttributes(c,{name:b,family_name:j}),p)try{await d.changePassword(c,A,p),n.success("Successfully updated password!",{style:i}),await u(2500)}catch(r){console.log(r)}if(l){await d.updateUserAttributes(c,{picture:l.picture});const r=await Storage.put(l.name,l,{level:"private",contentType:"image/*",completeCallback:m=>{console.log(`Successfully uploaded ${m.key}`)},errorCallback:m=>{console.error("Unexpected error while uploading",m)}});console.log(r)}n.success("Successfully updated profile!",{style:i}),await u(2500),t("/login")}catch(r){switch(P(!1),r.name){case"InvalidAccessKeyId":f("Invalid AWS Access Key ID.  Contact your app administrator.");break;case"InvalidPasswordException":f("Passwords did not confirm to the policy: min 8 characters, with at least: 1 uppercase, 1 lowercase");break;default:throw console.log("Unknown exception: ",r),f(r),await u(2500),r}D(""),K("")}}async function z(a){_(a.target.files[0])}const B=[{htmlFor:"first",text:"First Name",type:"text",id:"first",handleFn:L,value:S},{htmlFor:"last",text:"Last Name",type:"text",id:"last",handleFn:E,value:g},{htmlFor:"oldPassword",text:"Old Password",type:"password",id:"oldPassword",handleFn:k,value:x},{htmlFor:"password",text:q("Update Password <br/><span style='font-size:11px; color:silver'>Min 8 characters, containing at least: 1 uppercase, 1 lowercase, 1 numeric</span>"),type:"password",id:"password",handleFn:h,value:w},{htmlFor:"passwordConfirm",text:"Password Confirm",type:"password",id:"passwordConfirm",handleFn:F,value:v}];return e.jsxs("main",{className:N.login,children:[e.jsx(H,{}),e.jsx("h1",{children:`Update your profile for: ${s.email}`}),e.jsxs("form",{className:N.form,onSubmit:a=>$(a,S,g,w,x,v,I,h,F),children:[B.map(a=>e.jsx(J,{...a},a.id)),e.jsx(G,{handleFile:z}),e.jsxs("div",{style:{display:"flex",justifyContent:"space-between"},children:[e.jsx(C,{type:"primary",children:"Update Profile"}),e.jsx(M,{to:"/app/cities",children:R?e.jsx(T,{}):e.jsx(C,{type:"primary",children:"Cancel"})})]})]}),e.jsx("h2",{children:"Want to delete your account? Contact your app administrator."})]})}export{ae as default};
