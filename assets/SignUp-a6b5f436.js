import{r as o,u as R,j as s,S as _,B as z,_ as i,A as B,s as p}from"./index-9023de01.js";import{p as K,A as G}from"./index-1fb56753.js";import{P as M}from"./PageNav-0e784e85.js";import{s as b,F as T}from"./FormRow-98a93d00.js";import{S as W}from"./Storage-afeea0a8.js";import"./Title-14f9d088.js";const l={fontSize:"20px"},q="cbhuber@gmail.com,demo@demo.com".split(",");function u(e){i.error(e,{style:l}),p(2500)}function H(e){var t=/\S+@\S+\.\S+/;return t.test(e)}function m(e,t){return e?!0:(i.error(`${t} cannot be empty`,{style:l}),!1)}function J(e,t,c){return!m(e,"Email")||!m(t,"Password")||!m(c,"Password confirmation")?!1:H(e)?t!==c?(i.error("Passwords to not match",{style:l}),!1):!0:(i.error("Invalid email.",{style:l}),!1)}function O(e,t){return!(!m(e,"First name cannot be empty")||!m(t,"Last name cannot be empty"))}function te(){const[e,t]=o.useState(""),[c,f]=o.useState(""),[h,y]=o.useState(""),[w,P]=o.useState(""),[x,j]=o.useState(""),[E,N]=o.useState(""),[U,S]=o.useState(!1),A=R();async function k(a,r,v,g,F,$,d,L,D){if(a.preventDefault(),!!J(r,F,$)&&O(v,g)){if(!q.includes(r)){console.log(`${r} not allowed`),i.error(`User ${r} does not have permission. Contact the app admin for access.`,{style:l});return}try{S(!0),await B.signUp({username:r,password:F,attributes:{email:r,name:v,family_name:g,picture:d.name}}),await W.put(d.name,d,{level:"private",contentType:"image/*",completeCallback:n=>{console.log(`Successfully uploaded ${n.key}`)},errorCallback:n=>{console.error("Unexpected error while uploading",n)}}),i.success("Successfully signed up!",{style:l}),await p(2500),A("/confirm",{state:{email:r}})}catch(n){switch(S(!1),n.name){case"UsernameExistsException":u(`User account email ${r} already exists. Use a different email.`);break;case"InvalidAccessKeyId":u("Invalid AWS Access Key ID.  Contact your app administrator.");break;case"InvalidPasswordException":u("Passwords did not confirm to the policy: min 8 characters, with at least: 1 uppercase, 1 lowercase");break;default:throw console.log("Unknown exception: ",n),u(n),await p(2500),n}L(""),D("")}}}async function C(a){N(a.target.files[0])}const I=[{htmlFor:"email",text:"Email Address",type:"email",id:"email",handleFn:t,value:e},{htmlFor:"first",text:"First Name",type:"text",id:"first",handleFn:P,value:w},{htmlFor:"last",text:"Last Name",type:"text",id:"last",handleFn:j,value:x},{htmlFor:"password",text:K("Password <br/><span style='font-size:11px; color:silver'>Min 8 characters, containing at least: 1 uppercase, 1 lowercase, 1 numeric</span>"),type:"password",id:"password",handleFn:f,value:c},{htmlFor:"passwordConfirm",text:"Password Confirm",type:"password",id:"passwordConfirm",handleFn:y,value:h}];return s.jsxs("main",{className:b.login,children:[s.jsx(M,{}),s.jsx("h1",{children:"Sign up for GeoNotes!"}),s.jsxs("form",{className:b.form,onSubmit:a=>k(a,e,w,x,c,h,E,f,y),children:[I.map(a=>s.jsx(T,{...a},a.id)),s.jsx(G,{handleFile:C}),s.jsx("div",{children:U?s.jsx(_,{}):s.jsx(z,{type:"primary",children:"Sign Up"})})]})]})}export{te as default};
